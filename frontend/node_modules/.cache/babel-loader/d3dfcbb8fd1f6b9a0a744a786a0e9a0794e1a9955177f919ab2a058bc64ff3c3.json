{"ast":null,"code":"var _jsxFileName = \"/home/sergey/WebstormProjects/univer/filecrypt/src/context/AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useState, useEffect } from 'react';\nimport authApi from '../api/auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n  // Проверка аутентификации при загрузке\n  useEffect(() => {\n    const token = localStorage.getItem('access_token');\n    if (token) {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      if (payload.exp * 1000 > Date.now()) {\n        setUser({\n          email: payload.email,\n          name: payload.name\n        });\n        setIsAuthenticated(true);\n      } else {\n        localStorage.removeItem('access_token');\n      }\n    }\n    setLoading(false);\n  }, []);\n  const signIn = async (email, password) => {\n    setLoading(true);\n    try {\n      const response = await authApi.signIn(email, password);\n      localStorage.setItem('access_token', response.data.access_token);\n      localStorage.setItem('public_key', response.data.public_key);\n      setUser({\n        email: response.data.email\n      });\n      setIsAuthenticated(true);\n      return {\n        success: true\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n  const signUp = async (email, password, name, publicKey) => {\n    setLoading(true);\n    try {\n      const response = await authApi.signUp(email, password, name, publicKey);\n      localStorage.setItem('access_token', response.data.access_token);\n      localStorage.setItem('public_key', response.data.public_key);\n      return {\n        success: true\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    } finally {\n      setLoading(false);\n    }\n  };\n  const signOut = () => {\n    localStorage.removeItem('access_token');\n    setUser(null);\n    setIsAuthenticated(false);\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      loading,\n      isAuthenticated,\n      signIn,\n      signUp,\n      signOut\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 9\n  }, this);\n}\n_s(AuthProvider, \"xBgiRagNfQVCfEr2dT2PptfN+TE=\");\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n  return useContext(AuthContext);\n}\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useState","useEffect","authApi","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","user","setUser","loading","setLoading","isAuthenticated","setIsAuthenticated","token","localStorage","getItem","payload","JSON","parse","atob","split","exp","Date","now","email","name","removeItem","signIn","password","response","setItem","data","access_token","public_key","success","error","message","signUp","publicKey","signOut","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","$RefreshReg$"],"sources":["/home/sergey/WebstormProjects/univer/filecrypt/src/context/AuthContext.js"],"sourcesContent":["import { createContext, useContext, useState, useEffect } from 'react';\nimport authApi from '../api/auth';\n\nconst AuthContext = createContext();\n\nexport function AuthProvider({ children }) {\n    const [user, setUser] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n    // Проверка аутентификации при загрузке\n    useEffect(() => {\n        const token = localStorage.getItem('access_token');\n        if (token) {\n            const payload = JSON.parse(atob(token.split('.')[1]));\n            if (payload.exp * 1000 > Date.now()) {\n                setUser({\n                    email: payload.email,\n                    name: payload.name\n                });\n                setIsAuthenticated(true);\n            } else {\n                localStorage.removeItem('access_token');\n            }\n        }\n        setLoading(false);\n    }, []);\n\n    const signIn = async (email, password) => {\n        setLoading(true);\n        try {\n            const response = await authApi.signIn(email, password);\n            localStorage.setItem('access_token', response.data.access_token);\n            localStorage.setItem('public_key', response.data.public_key);\n            setUser({\n                email: response.data.email,\n            });\n            setIsAuthenticated(true);\n            return { success: true };\n        } catch (error) {\n            return { success: false, error: error.message };\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const signUp = async (email, password, name, publicKey) => {\n        setLoading(true);\n        try {\n            const response = await authApi.signUp(email, password, name, publicKey);\n            localStorage.setItem('access_token', response.data.access_token);\n            localStorage.setItem('public_key', response.data.public_key);\n            return { success: true };\n        } catch (error) {\n            return { success: false, error: error.message };\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const signOut = () => {\n        localStorage.removeItem('access_token');\n        setUser(null);\n        setIsAuthenticated(false);\n    };\n\n    return (\n        <AuthContext.Provider value={{\n            user,\n            loading,\n            isAuthenticated,\n            signIn,\n            signUp,\n            signOut\n        }}>\n            {children}\n        </AuthContext.Provider>\n    );\n}\n\nexport function useAuth() {\n    return useContext(AuthContext);\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}