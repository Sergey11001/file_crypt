{"ast":null,"code":"var _jsxFileName = \"/home/sergey/WebstormProjects/univer/filecrypt/src/components/Auth/SignUp.jsx\",\n  _s = $RefreshSig$();\nimport { useState } from 'react';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport { generateKeyPair, exportPublicKey, exportPrivateKey } from '../../utils/crypto';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function SignUp() {\n  _s();\n  var _location$state, _location$state$from;\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [name, setName] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const {\n    signUp\n  } = useAuth();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const from = ((_location$state = location.state) === null || _location$state === void 0 ? void 0 : (_location$state$from = _location$state.from) === null || _location$state$from === void 0 ? void 0 : _location$state$from.pathname) || '/dashboard';\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n    try {\n      // 1. Генерация ключевой пары\n      const keyPair = await generateKeyPair();\n\n      // 2. Экспорт публичного ключа для сервера\n      const publicKey = await exportPublicKey(keyPair.publicKey);\n\n      // 3. Экспорт приватного ключа в PEM для скачивания\n      const privateKeyPem = await exportPrivateKey(keyPair.privateKey);\n\n      // 4. Отправка данных на сервер\n      const {\n        success,\n        error\n      } = await signUp(email, password, name, publicKey);\n      if (success) {\n        // 5. Скачивание приватного ключа\n        downloadPrivateKey(privateKeyPem, email);\n\n        // 6. Перенаправление\n        navigate(from, {\n          replace: true\n        });\n      } else {\n        setError(error || 'Failed to sign up');\n      }\n    } catch (err) {\n      setError('An unexpected error occurred');\n      console.error('Registration error:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const downloadPrivateKey = (keyData, email) => {\n    const blob = new Blob([keyData], {\n      type: 'application/x-pem-file'\n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `filecrypt_${email}_private_key.pem`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"auth-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"auth-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"auth-title\",\n        children: \"Create Account\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 17\n      }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"error-message\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 27\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-4 p-4 bg-blue-50 rounded-lg text-sm\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"font-medium\",\n          children: \"Important:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"After registration, your private key will be downloaded automatically.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Save it securely - it cannot be recovered!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        className: \"auth-form\",\n        onSubmit: handleSubmit,\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"btn btn-primary\",\n          disabled: loading,\n          children: loading ? 'Creating Account...' : 'Sign Up'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"auth-footer\",\n        children: [\"Already have an account?\", ' ', /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/signin\",\n          className: \"link\",\n          state: {\n            from\n          },\n          children: \"Sign In\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 9\n  }, this);\n}\n_s(SignUp, \"2KqQYLarIJbyY45+rIAyp1zwRxo=\", false, function () {\n  return [useAuth, useNavigate, useLocation];\n});\n_c = SignUp;\nvar _c;\n$RefreshReg$(_c, \"SignUp\");","map":{"version":3,"names":["useState","useAuth","Link","useNavigate","useLocation","generateKeyPair","exportPublicKey","exportPrivateKey","jsxDEV","_jsxDEV","SignUp","_s","_location$state","_location$state$from","email","setEmail","password","setPassword","name","setName","error","setError","loading","setLoading","signUp","navigate","location","from","state","pathname","handleSubmit","e","preventDefault","keyPair","publicKey","privateKeyPem","privateKey","success","downloadPrivateKey","replace","err","console","keyData","blob","Blob","type","url","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","disabled","to","_c","$RefreshReg$"],"sources":["/home/sergey/WebstormProjects/univer/filecrypt/src/components/Auth/SignUp.jsx"],"sourcesContent":["import { useState } from 'react';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport { generateKeyPair, exportPublicKey, exportPrivateKey } from '../../utils/crypto';\n\nexport default function SignUp() {\n    const [email, setEmail] = useState('');\n    const [password, setPassword] = useState('');\n    const [name, setName] = useState('');\n    const [error, setError] = useState('');\n    const [loading, setLoading] = useState(false);\n    const { signUp } = useAuth();\n    const navigate = useNavigate();\n    const location = useLocation();\n\n    const from = location.state?.from?.pathname || '/dashboard';\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setError('');\n        setLoading(true);\n\n        try {\n            // 1. Генерация ключевой пары\n            const keyPair = await generateKeyPair();\n\n            // 2. Экспорт публичного ключа для сервера\n            const publicKey = await exportPublicKey(keyPair.publicKey);\n\n            // 3. Экспорт приватного ключа в PEM для скачивания\n            const privateKeyPem = await exportPrivateKey(keyPair.privateKey);\n\n            // 4. Отправка данных на сервер\n            const { success, error } = await signUp(email, password, name, publicKey);\n\n            if (success) {\n                // 5. Скачивание приватного ключа\n                downloadPrivateKey(privateKeyPem, email);\n\n                // 6. Перенаправление\n                navigate(from, { replace: true });\n            } else {\n                setError(error || 'Failed to sign up');\n            }\n        } catch (err) {\n            setError('An unexpected error occurred');\n            console.error('Registration error:', err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const downloadPrivateKey = (keyData: string, email: string) => {\n        const blob = new Blob([keyData], { type: 'application/x-pem-file' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `filecrypt_${email}_private_key.pem`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    };\n\n    return (\n        <div className=\"auth-container\">\n            <div className=\"auth-card\">\n                <h1 className=\"auth-title\">Create Account</h1>\n\n                {error && <div className=\"error-message\">{error}</div>}\n\n                <div className=\"mb-4 p-4 bg-blue-50 rounded-lg text-sm\">\n                    <p className=\"font-medium\">Important:</p>\n                    <p>After registration, your private key will be downloaded automatically.</p>\n                    <p>Save it securely - it cannot be recovered!</p>\n                </div>\n\n                <form className=\"auth-form\" onSubmit={handleSubmit}>\n                    {/* ... остальные поля формы ... */}\n                    <button\n                        type=\"submit\"\n                        className=\"btn btn-primary\"\n                        disabled={loading}\n                    >\n                        {loading ? 'Creating Account...' : 'Sign Up'}\n                    </button>\n                </form>\n\n                <div className=\"auth-footer\">\n                    Already have an account?{' '}\n                    <Link to=\"/signin\" className=\"link\" state={{ from }}>\n                        Sign In\n                    </Link>\n                </div>\n            </div>\n        </div>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}